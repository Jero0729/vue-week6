"use strict";(self["webpackChunk_17_week6"]=self["webpackChunk_17_week6"]||[]).push([[843],{843:function(e,t,a){a.r(t),a.d(t,{default:function(){return M}});var l=a(6252),s=a(3577),d=a(9963);const o=e=>((0,l.dD)("data-v-004c1ae4"),e=e(),(0,l.Cn)(),e),i={class:"container"},r=o((()=>(0,l._)("h2",null,"購物車",-1))),n={class:"mt-3"},c={class:"text-end"},m=["disabled"],u={class:"table align-middle table-hover"},h=o((()=>(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th"),(0,l._)("th",null,"品名"),(0,l._)("th",{style:{width:"150px"}},"數量/單位"),(0,l._)("th",{class:"text-end"},"單價")])],-1))),p=["disabled","onClick"],g={key:0,class:"fas fa-spinner fa-pulse"},_=(0,l.Uk)(" 刪除 "),f={key:0,class:"text-success"},b={class:"input-group input-group-sm"},v={class:"input-group mb-3"},k=["onUpdate:modelValue","onBlur","disabled"],y={class:"input-group-text",id:"basic-addon2"},w={class:"text-end"},x={key:0,class:"text-success"},C={key:1},V=o((()=>(0,l._)("td",{class:"text-center",colspan:"4"}," 目前尚未有品項 ",-1))),q=[V],S=o((()=>(0,l._)("td",{colspan:"3",class:"text-end"},"總計",-1))),I={class:"text-end"},U={key:0},W=o((()=>(0,l._)("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1))),D={class:"text-end text-success"},$={class:"my-5 row justify-content-center"},z={class:"mb-3"},L=o((()=>(0,l._)("label",{for:"email",class:"form-label"},"Email",-1))),O={class:"mb-3"},A=o((()=>(0,l._)("label",{for:"name",class:"form-label"},"收件人姓名",-1))),E={class:"mb-3"},F=o((()=>(0,l._)("label",{for:"tel",class:"form-label"},"收件人行動電話",-1))),j={class:"mb-3"},B=o((()=>(0,l._)("label",{for:"address",class:"form-label"},"收件人地址",-1))),H={class:"mb-3"},P=o((()=>(0,l._)("label",{for:"message",class:"form-label"},"留言",-1))),Y={class:"text-end"},K=["disabled"];function T(e,t,a,o,V,T){const Z=(0,l.up)("VLoading"),G=(0,l.up)("VField"),J=(0,l.up)("error-message"),M=(0,l.up)("VForm");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(Z,{active:V.isLoading},null,8,["active"]),(0,l._)("div",i,[r,(0,l._)("div",n,[(0,l._)("div",c,[(0,l._)("button",{class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=(...e)=>T.deleteAllCarts&&T.deleteAllCarts(...e)),disabled:0===V.cart.carts?.length}," 清空購物車 ",8,m)]),(0,l._)("table",u,[h,(0,l._)("tbody",null,[0!==V.cart?.carts?.length?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(V.cart.carts,(e=>((0,l.wg)(),(0,l.iD)("tr",{key:e.id},[(0,l._)("td",null,[(0,l._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:V.loadingStatus.loadingItem===e.id,onClick:t=>T.deleteOneCart(e.id)},[V.loadingStatus.loadingItem===e.id?((0,l.wg)(),(0,l.iD)("i",g)):(0,l.kq)("",!0),_],8,p)]),(0,l._)("td",null,[(0,l.Uk)((0,s.zw)(e.product.title)+" ",1),e.coupon?((0,l.wg)(),(0,l.iD)("div",f," 已套用優惠券 ")):(0,l.kq)("",!0)]),(0,l._)("td",null,[(0,l._)("div",b,[(0,l._)("div",v,[(0,l.wy)((0,l._)("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":t=>e.qty=t,onBlur:t=>T.update(e),disabled:V.loadingStatus.loadingItem===e.id},null,40,k),[[d.nr,e.qty,void 0,{number:!0}]]),(0,l._)("span",y,(0,s.zw)(e.product.unit),1)])])]),(0,l._)("td",w,[V.cart.final_total!==V.cart.total?((0,l.wg)(),(0,l.iD)("small",x,"折扣價：")):(0,l.kq)("",!0),(0,l.Uk)(" "+(0,s.zw)(e.final_total),1)])])))),128)):((0,l.wg)(),(0,l.iD)("tr",C,q))]),(0,l._)("tfoot",null,[(0,l._)("tr",null,[S,(0,l._)("td",I,(0,s.zw)(V.cart.total),1)]),V.cart.final_total!==V.cart.total?((0,l.wg)(),(0,l.iD)("tr",U,[W,(0,l._)("td",D,(0,s.zw)(V.cart.final_total),1)])):(0,l.kq)("",!0)])])]),(0,l._)("div",$,[(0,l.Wm)(M,{ref:"form",class:"col-md-6",onSubmit:T.createOrder},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",z,[L,(0,l.Wm)(G,{id:"email",name:"email",type:"email",class:(0,s.C_)(["form-control",{"is-invalid":e["email"]}]),rules:"email|required",modelValue:V.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=e=>V.form.user.email=e),placeholder:"請輸入 Email"},null,8,["class","modelValue"]),(0,l.Wm)(J,{name:"email",class:"invalid-feedback"})]),(0,l._)("div",O,[A,(0,l.Wm)(G,{id:"name",name:"姓名",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":e["姓名"]}]),placeholder:"請輸入姓名",rules:"required",modelValue:V.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=e=>V.form.user.name=e)},null,8,["class","modelValue"]),(0,l.Wm)(J,{name:"姓名",class:"invalid-feedback"})]),(0,l._)("div",E,[F,(0,l.Wm)(G,{id:"tel",name:"行動電話",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":e["行動電話"]}]),rules:T.isPhone,modelValue:V.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=e=>V.form.user.tel=e),placeholder:"請輸入行動電話"},null,8,["class","rules","modelValue"]),(0,l.Wm)(J,{name:"行動電話",class:"invalid-feedback"})]),(0,l._)("div",j,[B,(0,l.Wm)(G,{id:"address",name:"地址",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":e["地址"]}]),placeholder:"請輸入地址",rules:"required",modelValue:V.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=e=>V.form.user.address=e)},null,8,["class","modelValue"]),(0,l.Wm)(J,{name:"地址",class:"invalid-feedback"})]),(0,l._)("div",H,[P,(0,l.wy)((0,l._)("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=e=>V.form.message=e)},null,512),[[d.nr,V.form.message]])]),(0,l._)("div",Y,[(0,l._)("button",{type:"submit",class:"btn btn-danger",disabled:Object.keys(e).length>0||0===V.cart.carts?.length,onClick:t[6]||(t[6]=(...e)=>T.loading&&T.loading(...e))}," 送出訂單 ",8,K)])])),_:1},8,["onSubmit"])])])],64)}var Z={data(){return{loadingStatus:{loadingItem:""},isLoading:!1,cart:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},coupon_code:""}},methods:{getCart(){this.$http.get("https://vue3-course-api.hexschool.io/v2//api/mmee1122/cart").then((e=>{this.cart=e.data.data})).catch((e=>{alert(e.data.message)}))},deleteAllCarts(){this.$http.delete("https://vue3-course-api.hexschool.io/v2//api/mmee1122/carts").then((e=>{alert(e.data.message),this.getCart()})).catch((e=>{alert(e.data.message)}))},deleteOneCart(e){this.loadingStatus.loadingItem=e,this.$http.delete(`https://vue3-course-api.hexschool.io/v2//api/mmee1122/cart/${e}`).then((e=>{alert(e.data.message),this.loadingStatus.loadingItem="",this.getCart()})).catch((e=>{alert(e.data.message)}))},update(e){this.loadingStatus.loadingItem=e.id;const t={product_id:e.product_id,qty:e.qty};this.$http.put(`https://vue3-course-api.hexschool.io/v2//api/mmee1122/cart/${e.id}`,{data:t}).then((e=>{alert(e.data.message),this.loadingStatus.loadingItem="",this.getCart()})).catch((e=>{alert(e.data.message),this.loadingStatus.loadingItem=""}))},createOrder(){const e=this.form;this.$http.post("https://vue3-course-api.hexschool.io/v2//api/mmee1122/order",{data:e}).then((e=>{alert(e.data.message),this.$refs.form.resetForm(),this.form.message="",this.getCart()})).catch((e=>{alert(e.data.message)}))},isPhone(e){const t=/^(09)[0-9]{8}$/;return!!t.test(e)||"需要正確的行動電話"},loading(){this.isLoading=!0,setTimeout((()=>{this.isLoading=!1}),1e3)}},watch:{"cart.carts":{handler(e){e.forEach((e=>{(e.qty<0||0===e.qty)&&(alert("數量不能低於1"),e.qty=1)}))},deep:!0}},mounted(){this.getCart(),this.loading()}},G=a(3744);const J=(0,G.Z)(Z,[["render",T],["__scopeId","data-v-004c1ae4"]]);var M=J}}]);
//# sourceMappingURL=843.15cb856e.js.map